<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>七彩箱</title>
    <style type="text/css">
		.xiang {border-style: solid; border-width: 5px;border-color: blue;text-align:center;background-color:blue;color:white;margin:1px 1px 1px 1px;width:auto;height:50px;line-height:50px;float:left;}
		.btn {border-style: solid; border-width: 5px;border-color: blue;text-align:center;background-color:blue;color:white;margin:1px 1px 1px 1px;width:auto;height:50px;line-height:50px;float:left;}
		.qi {background-color:gray;color:white;margin:1px 1px 1px 1px;width:100%;height:100%;float:left;}
    </style>
</head>
<body>
<div class="qi" id="tools">
    <div class="xiang" id="tomcat">tomcat</div>
    <div class="xiang" id="jdb">jdb</div>
    <div class="btn" id="addbtn">+</div>
    <div class="btn" id="dbgbtn">调试开</div>
    <div class="btn" id="subbtn" ><input type="text" id="breakpointText"  size="90" /><input type="text" id="cmdText"  size="30" /><button id="submitCmd">提交</button></div>
</div>
<div class="qi" id="main">
    <div class="xiang">cont</div>
    <div class="xiang">classes</div>
    <div class="xiang">threads</div>
    <div class="xiang">exclude com.mchange.*,com.mysql.*,com.sun.*,java.*,javax.*,jdk.*,org.*,sun.*,websocket.*</div>
    <div class="xiang">stop at com.jxust.svsh.controller.PersonController:66</div>
    <div class="xiang">stop at com.jxust.svsh.controller.PersonController:135</div>
    <div class="xiang">trace go methods</div>
    <div class="xiang">locals</div>
    <div class="xiang">exit</div>
</div>
<div class="qi" id="breakpointDiv">
    <div class="xiang">#</div>
</div>
<div class="qi" id="msg">
    <div class="xiang"></div>
</div>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
<script src="base64.js"></script>
<!--
<script src="http://ksylvest.github.io/jquery-growl/javascripts/jquery.growl.js" type="text/javascript"></script>
<link href="http://ksylvest.github.io/jquery-growl/stylesheets/jquery.growl.css" rel="stylesheet" type="text/css" />
-->
<script type="text/javascript">
function bpline(bp){

bp = bp.split('.').join('_');
bp = bp.split('=').join('_');
bp = bp.split(' ').join('');
bp = bp.replace('行','line');
bp = bp.replace('()','');
bp = bp.split(',');
return bp[1]+bp[2];

}
//替换所有的回车换行
function TransferString(content)
{
    var string = content;
    try{
        string=string.replace(/\r\n/g,"<br>")
        string=string.replace(/\n/g,"<br>");
    }catch(e) {
        alert(e.message);
    }
    return string;
}

    $(document).ready(function(){
        $(".xiang").click(function(){
            $.get("/jdbcmd/"+$(this).text());
            //$(this).slideToggle();
            $(this).css("background-color","yellow");
       });

        $("#addbtn").click(function(){
            $('#main').append("<div class='xiang'>new cmd</div>");
       });

         $("#submitCmd").click(function(){
            //$.get("/jdbcmd/"+$("#cmdText").val());
            var bpid = codeHandler.encode($("#breakpointText").val(),'base64');
            $('#breakpointDiv').append("<div id='"+bpid+"' class='xiang'>"+$("#cmdText").val()+"</div>");

            /*
             $('.xiang').unbind('click').bind('click',(function(){
                 $.get("/jdbcmd/"+$(this).text());
                //$(this).slideToggle();
                $(this).css("background-color","yellow");
              }));
            */
       });
    //end
    });

  //$.growl({ title: "Growl", message: "The kitten is awake!" });
  //$.growl.error({ message: "The kitten is attacking!" });
  //$.growl.notice({ message: "The kitten is cute!" });
  //$.growl.warning({ message: "The kitten is ugly!" });

    $("#dbgbtn").click(function(){
        if(kaiguan){
            $('#dbgbtn').text('调试关');
             kaiguan = false;
        }else{
            $('#dbgbtn').text('调试开');
             kaiguan = true;
        }
    });
    //刷新调试日志
    kaiguan = true;
    setInterval(function () {
    if(kaiguan) return;
	$.ajax({
    type : "get",
    async : true,
    url : "/debug",
    dataType:"json",
    success:function(result) {
            $("#msg").empty();
            for(let index in result) {
                str = result[index];
                $("<div class='xiang'>"+str+"</div>").appendTo("#msg");
                //去掉最后的换行符/n/r
                str = str.slice(0,-2);
                //根据base64编码找id对应的元素
                var bpid = codeHandler.encode(str,'base64');
                console.log("!!!!!!!!!!!!!!!!!!!!!"+$("#"+bpid).text());
                if($("#"+bpid).text() ){
                    //console.log(bpline(str));
                    //$.growl.notice({ message: "断点命中！"+index });
                }
            };
   },
    error : function(errorMsg) {
    }
});
}, 1000);
</script>
</body>
</html>